## 关于嵌入模型的探究




### Q&A
#### 1、为什么一个句子嵌入之后维度是单个维度？
比如这句话：
```text
Outcome: The patient experienced a resolution of acute chest syndrome symptoms. However, there are ongoing management challenges associated with SCD and medication side effects. The management plan involves continuous coordination between hematology and rheumatology specialists for concurrent SCD and SLE management.
```
经过嵌入模型，这里选用`all-MiniLM-L12-v2`，得到的嵌入结果是：
```
[-2.47010998e-02 -5.22787794e-02  6.18462358e-03  2.33554039e-02, -7.06541957e-03 -4.08811979e-02  1.00771035e-03 -3.63331772e-02, -4.86065112e-02 -1.69440322e-02 -8.16059485e-02  7.61171058e-02,  5.03332503e-02  6.03593513e-02 -4.95887510e-02 -4.50310186e-02,  2.86221248e-03 -1.10859349e-02 -1.33119384e-02  6.10558614e-02, -6.80319890e-02  4.40545343e-02  2.37466842e-02 -1.11295357e-01, -3.58572640e-02 -3.36787291e-02  7.17347302e-03 -1.99095439e-02,  5.52583151e-02 -3.96907097e-03  6.21705092e-02 -4.34499420e-02,  2.84020398e-02 -3.28731500e-02 -6.69647306e-02  3.31714451e-02, -1.96799990e-02  7.18121827e-02 -4.03142115e-03 -1.03052333e-03, -2.20698621e-02  4.12516966e-02  2.79883537e-02  2.44615208e-02, -3.76073527e-03 -2.67504472e-02 -2.37237737e-02  8.35451297e-03,  1.04259355e-02  1.69002544e-02 -2.40427349e-02  1.61218923e-02,  5.36341295e-02 -3.47711295e-02  2.89716590e-02  8.83650333e-02,  1.40484916e-02  4.15965542e-02 -1.06976256e-01  7.63528887e-03, -8.48991051e-03 -1.90412905e-02 -3.08642387e-02 -1.34289013e-02,  8.99398923e-02 -1.18209878e-02 -3.29861119e-02 -5.89474887e-02,  5.65035120e-02  4.16710675e-02  9.23819318e-02 -4.34603803e-02, -7.01615736e-02 -1.93396285e-02  9.02399272e-02  3.78200002e-02, -3.91012393e-02 -6.90913573e-03  9.53364298e-02 -4.30189818e-03, -3.29359211e-02  2.64800340e-02  1.47323273e-02 -5.94914076e-04, -2.13817991e-02  5.80869466e-02 -2.43896581e-02 -1.59243681e-02,  5.27340546e-02 -3.49795409e-02  5.79071753e-02  7.48911360e-03,  7.15276897e-02 -9.13699716e-02  1.26168486e-02 -1.88279022e-02,  4.30872515e-02  5.52246086e-02 -4.94806953e-02 -3.30249220e-02,  3.75420302e-02  3.36444750e-02  4.88574281e-02 -8.46356805e-03, -9.45300050e-03 -5.38975336e-02  4.16067801e-02  3.08662616e-02, -1.01441532e-01 -3.39241847e-02 -3.74983088e-03 -3.10641900e-02,  6.98849857e-02 -1.25297070e-01 -1.04069002e-02  5.76409362e-02,  7.26810843e-02  5.58069646e-02  7.54724443e-02 -4.46123816e-02, -1.34020135e-01  4.49524373e-02  8.51641223e-02 -9.83198062e-02, -3.73877063e-02  3.13513130e-02 -1.25895627e-02  1.35345003e-02, -5.64340036e-03 -2.87980400e-03  1.08130559e-01  9.57320184e-02, -1.59255322e-02 -4.52899523e-02  1.66248679e-02 -5.34489304e-02,  2.94120964e-02 -1.46121792e-02  1.24100293e-03  7.97928032e-03, -3.40678776e-03  2.22673248e-02 -8.20726901e-02 -7.08464580e-03,  3.16171371e-03  3.89178805e-02 -3.97181213e-02  3.26007344e-02, -5.60633745e-03 -3.90359536e-02  3.61791514e-02 -1.37082227e-02, -5.85973961e-03  7.97623992e-02  1.85749698e-02  5.70688024e-02,  8.96557048e-02  3.99981588e-02 -2.75992155e-02  7.57261068e-02, -9.05424822e-03 -3.80004533e-02 -4.25112173e-02  2.67145829e-03,  2.37712022e-02  4.74217534e-02 -1.22969570e-02  2.04016622e-02,  4.70721349e-02 -1.57015305e-02 -7.65365288e-02 -8.02304745e-02,  9.80045348e-02 -2.86425184e-02  2.08666977e-02 -7.44588822e-02,  7.71446573e-03 -2.78638285e-02 -3.03642601e-02 -2.62157321e-02,  6.07259311e-02  5.27011529e-02  4.24237028e-02  6.24342225e-02, -6.38499707e-02 -1.89120658e-02  7.91657530e-03 -1.78903434e-02,  8.71054828e-02  2.03232914e-02 -4.47695963e-02  6.61697760e-02, -7.12781549e-02 -4.52200733e-02  8.86959210e-02 -1.91781037e-02, -1.25812013e-02  3.04398350e-02 -2.08954867e-02  2.92571578e-02,  7.30554536e-02  9.03202035e-03  4.21312153e-02  4.63997982e-02,  7.70093203e-02  2.43453048e-02 -1.91692915e-02 -8.11409801e-02, -2.42365468e-02 -2.66835336e-02  7.71791721e-03  1.12480752e-01,  4.50567603e-02 -8.82584229e-02 -4.11422886e-02 -1.81548099e-03, -7.75025710e-02  1.34343449e-02 -1.03029490e-01  5.95879089e-03, -1.68014988e-02  1.01985559e-01  4.31954227e-02  3.08692421e-33, -2.68251635e-02  4.53354195e-02 -1.56200156e-02 -8.07628632e-02, -1.37223070e-02  4.51268181e-02 -8.18667710e-02 -2.53537130e-02,  6.18678033e-02 -1.30969770e-02 -2.58227024e-04 -1.93539429e-02, -8.26132670e-02  2.52939239e-02 -6.56789318e-02 -8.35605152e-03, -1.92018785e-02 -1.09490134e-01  2.43446790e-02  5.72967939e-02,  7.62801319e-02 -3.21190134e-02  1.91902071e-02  4.47012782e-02,  7.99569041e-02  4.13030349e-02  1.51188094e-02 -4.46232148e-02, -5.46290260e-03 -1.15021534e-01  1.61063357e-03  3.09715681e-02, -8.83681700e-03 -3.72419693e-03 -2.94735152e-02  1.85407680e-02,  5.32646552e-02  3.25295292e-02 -4.52410057e-03 -4.11276072e-02,  4.46444713e-02 -2.17666980e-02  2.35910323e-02 -3.38936560e-02,  1.52817830e-01  4.16037366e-02  4.29268330e-02 -6.43313006e-02, -4.37263027e-02 -4.82567884e-02 -3.53882238e-02 -5.44674955e-02,  5.00879176e-02  5.19760624e-02  4.49656583e-02 -7.27224275e-02, -7.55079314e-02 -3.09461989e-02 -1.57658055e-01 -9.31852777e-03,  4.73567583e-02  8.41493756e-02 -7.23561877e-03 -6.54586181e-02, -2.74705924e-02  3.87864150e-02 -5.52303866e-02 -1.15912244e-01,  2.94894185e-02 -6.51700795e-03 -5.73705919e-02 -1.00999296e-01, -8.76968279e-02  3.01331393e-02  4.77172025e-02 -5.82558438e-02, -5.16679995e-02 -6.26342669e-02  2.48063616e-02  3.50069702e-02, -8.66350904e-02 -1.60987359e-02 -1.45020541e-02 -1.97127350e-02,  5.19624352e-02 -4.52998793e-03 -1.10024596e-02 -4.18499783e-02, -2.65085511e-02  1.03392797e-02  4.09781821e-02 -2.71923076e-02, -3.09422184e-02 -9.66871232e-02 -1.41484709e-02  6.36117592e-32, -5.39629348e-03 -2.81415451e-02 -3.73126613e-03 -2.68335938e-02, -2.04327907e-02  2.01179218e-02  5.12067508e-03  4.55738157e-02,  3.72259282e-02  1.05582051e-01 -5.87512143e-02  1.06691100e-01,  5.39889857e-02 -7.22327381e-02  3.13520022e-02  4.85899821e-02, -2.96829212e-02  8.17837119e-02  9.30603594e-03 -8.20883960e-02,  4.17043865e-02  1.48451119e-03  5.46085723e-02  2.36276686e-02, -8.52654204e-02  1.23979682e-02 -1.73005611e-02 -1.01348318e-01,  5.44596277e-02  3.62137370e-02 -1.70485117e-02 -2.46196743e-02,  6.71786144e-02 -1.85766537e-02  8.94614011e-02 -6.29165545e-02,  4.00436036e-02  4.34421422e-03  5.13883792e-02 -1.61305480e-02, -4.02405970e-02  1.10369124e-01  7.07206577e-02  2.34195571e-02,  2.89590247e-02 -1.70157239e-01 -6.77094758e-02 -2.19186042e-02, -6.50168210e-02  3.62218707e-03 -2.35968791e-02 -2.33028622e-04, -6.15093373e-02  5.66627756e-02  5.72408829e-03 -2.72056833e-02,  7.74751976e-03 -1.86732356e-02 -1.90577190e-02 -9.69249010e-03, -3.28155306e-06 -6.65139556e-02  1.04676448e-02  2.86358409e-02]
```
维度是(384,)，对于文本嵌入来说，正常应该是`（batch_size，sequence_length, hidden_size）`这样的格式，当前使用[google bert](https://huggingface.co/docs/transformers/en/model_doc/bert)也是这样的结果，,为什么这些嵌入模型的的维度为1并且长度也不等于文本的长度?
A: 这个问题是使用了`outputs.last_hidden_state.mean(dim=1).squeeze().numpy()` 在 sequence_length上取平均，结果是`(batch_size, hidden_size)`，这样做有利用统一维度，并且考虑了所有的token信息。

